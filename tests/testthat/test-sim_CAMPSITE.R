
set.seed(20220327)

test_that("campsite-simulation-works", {

  pars <- cs_pars(lambda1 = 0.3)
  test_res1 <- cs_simulate(pars, ou = list(opt = 0, alpha4 = 0), root.value = 0, age.max = 10, 
                     age.ext = NULL, step_size = 0.01, bounds = c(-Inf, Inf), 
                     plot = FALSE, ylims = NULL, full_results = TRUE) 
  
  
  
  expect_equal(test_res1$traits[[1]]$trait_values %>% tail(10),  
               c(1.23129538863564, 1.1338153828743, 1.13000566261967, 1.00551190882377, 
                         0.93060476278763, 0.792652969148525, 0.932508278028777, 0.887101589753461, 
                         0.918827490177646, 0.90234241467704))
  
  expect_equal(test_res1$traits[[6]]$trait_values %>% tail(10),  
               c(1.28907803906155, 1.3341696973646, 1.35899303314962, 1.37144768718541, 
                 1.34174148120387, 1.42956921627745, 1.46292537532325, 1.45376212011431, 
                 1.46981724912686, 1.46355444981157))
  
  expect_length(test_res1$traits, 12)
  expect_s3_class(test_res1$traits[["lin1"]], c("list", "cs_trait"))
  
  expect_s3_class(test_res1$lineages, c("matrix", "array", "cs_lineages"))
  expect_equal(dim(test_res1$lineages), c(12L, 7L))
  
  expect_equal(test_res1$lineages,
    structure(c(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 2, 5, 3, 0, 4, 
                0, 0, 0, 0, 6, 0, 0, 0, 0, 3.78999999999996, 3.78999999999996, 
                5.58999999999993, 5.58999999999993, 7.26999999999989, 7.26999999999989, 
                7.28999999999989, 7.28999999999989, 9.83999999999983, 9.83999999999983, 
                3.78999999999996, 7.28999999999989, 5.58999999999993, 9.99999999999983, 
                7.26999999999989, 9.99999999999983, 9.99999999999983, 9.99999999999983, 
                9.99999999999983, 9.83999999999983, 9.99999999999983, 9.99999999999983, 
                1, 1, 1, -1, 1, -1, 1, -1, 1, 1, 1, -1, 0, 3.39999999999997, 
                3.78999999999996, NA, 5.58999999999993, NA, 7.26999999999989, 
                NA, 7.28999999999989, 8.25999999999987, 9.83999999999983, NA, 
                0, 3.39999999999997, 3.78999999999996, NA, 5.58999999999993, 
                NA, 7.26999999999989, NA, 7.28999999999989, 8.25999999999987, 
                9.83999999999983, NA), .Dim = c(12L, 7L), .Dimnames = list(NULL, 
                                                                           NULL)),
    ignore_attr = TRUE
  )
  
  
  expect_equal(test_res1$trees$all$tips,
               c(t1 = 0.762551248525563, t2 = 1.46355444981157, t3 = 1.01951555919899, 
                 t4 = 1.65047123919833, t5 = -1.58355453894397, t6 = 1.9484608993786, 
                 t7 = 2.35152225854184))
  
  expect_equal(test_res1$trees$gsp_fossil$tips,
               c(t3 = 1.01951555919899, t5 = -1.58355453894397, t6 = 1.9484608993786))
})



